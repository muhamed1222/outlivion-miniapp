# ‚úÖ –£–ª—É—á—à–µ–Ω–∏—è Telegram –±–æ—Ç–∞ - –ó–ê–í–ï–†–®–ï–ù–û

**–î–∞—Ç–∞:** 3 –¥–µ–∫–∞–±—Ä—è 2025, 23:08 MSK  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–°–ï –£–õ–£–ß–®–ï–ù–ò–Ø –ü–†–ò–ú–ï–ù–ï–ù–´

---

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. ‚úÖ –í–æ–∑–≤—Ä–∞—â–µ–Ω–æ Markdown —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω `parse_mode: 'Markdown'` –≤ `handleStartCommand`
- –î–æ–±–∞–≤–ª–µ–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤ –≤ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∂–∏—Ä–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `getWelcomeMessage`

**–§–∞–π–ª:** `src/lib/bot.ts`

```typescript
export function getWelcomeMessage(firstName: string): string {
  // –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã –¥–ª—è Markdown
  const escapedName = firstName.replace(/[_*[\]()~`>#+\-=|{}.!]/g, '\\$&');
  
  return `
üëã –ü—Ä–∏–≤–µ—Ç, ${escapedName}!

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ **Outlivion VPN** ‚Äî –≤–∞—à –Ω–∞–¥–µ–∂–Ω—ã–π –∏ –±—ã—Å—Ç—Ä—ã–π VPN —Å–µ—Ä–≤–∏—Å.

üîê **–ß—Ç–æ –º—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º:**
‚Ä¢ –í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
‚Ä¢ –°–µ—Ä–≤–µ—Ä—ã –ø–æ –≤—Å–µ–º—É –º–∏—Ä—É
‚Ä¢ –í–æ–µ–Ω–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ AES-256
‚Ä¢ –ü–æ–ª–Ω–∞—è –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç—å, –±–µ–∑ –ª–æ–≥–æ–≤

–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å! üëá
  `.trim()
}
```

---

### 2. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î

**–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª:** `src/lib/bot-api.ts`

–§—É–Ω–∫—Ü–∏—è `createOrUpdateUser()` –≤—ã–∑—ã–≤–∞–µ—Ç backend API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ `/start`.

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `handleStartCommand`:**

```typescript
// –°–æ–∑–¥–∞—ë–º –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î —á–µ—Ä–µ–∑ backend API
console.log('[BOT] Creating/updating user in database...')
const userResult = await createOrUpdateUser({
  telegramId: from.id,
  firstName: from.first_name,
  lastName: from.last_name,
  username: from.username,
  photoUrl: from.photo_url,
})

if (userResult.success) {
  console.log('[BOT] User created/updated in database:', userResult.userId)
} else {
  console.warn('[BOT] Failed to create/update user in database:', userResult.error)
  // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞–±–æ—Ç—É –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –¢—Ä–µ–±—É–µ—Ç—Å—è, —á—Ç–æ–±—ã backend API –ø—Ä–∏–Ω–∏–º–∞–ª –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –±–æ—Ç–∞. –ï—Å–ª–∏ backend –æ—Ç–∫–ª–æ–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å (–∏–∑-–∑–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏), –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å–µ —Ä–∞–≤–Ω–æ –ø–æ–ª—É—á–∏—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –Ω–æ –Ω–µ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –≤ –ë–î.

---

### 3. ‚úÖ –†–µ–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ –∏–∑ API

**–û–±–Ω–æ–≤–ª—ë–Ω `handleStatusCommand`:**

```typescript
// –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ –∏–∑ API
const subscriptionResult = await getUserSubscription(userId)

if (subscriptionResult.success && subscriptionResult.subscription) {
  const sub = subscriptionResult.subscription
  const endDate = new Date(sub.endDate)
  const daysLeft = Math.ceil((endDate.getTime() - Date.now()) / (1000 * 60 * 60 * 24))
  
  statusText = `
üìä **–°—Ç–∞—Ç—É—Å –≤–∞—à–µ–π –ø–æ–¥–ø–∏—Å–∫–∏:**

üì¶ –¢–∞—Ä–∏—Ñ: ${sub.plan === 'monthly' ? '–ú–µ—Å—è—á–Ω—ã–π' : sub.plan === 'yearly' ? '–ì–æ–¥–æ–≤–æ–π' : sub.plan}
‚úÖ –°—Ç–∞—Ç—É—Å: –ê–∫—Ç–∏–≤–Ω–∞
üìÖ –î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ: ${endDate.toLocaleDateString('ru-RU')}
‚è∞ –û—Å—Ç–∞–ª–æ—Å—å –¥–Ω–µ–π: ${daysLeft}
  `.trim()
} else {
  statusText = '‚ùå –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏.'
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –¢—Ä–µ–±—É–µ—Ç—Å—è endpoint –Ω–∞ backend `/user/subscription?telegramId=<id>` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ Telegram ID.

---

### 4. ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω –≤–∞–ª–∏–¥–Ω—ã–π secret token

**–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π token:** `1d168686c6497beead17a0eb8d2c45be`

**–î–µ–π—Å—Ç–≤–∏—è:**
1. Token –¥–æ–±–∞–≤–ª–µ–Ω –≤ Vercel: `TELEGRAM_WEBHOOK_SECRET`
2. Webhook –±—É–¥–µ—Ç –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Å secret token
3. –¢–µ–ø–µ—Ä—å webhook –∑–∞—â–∏—â—ë–Ω –æ—Ç –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

---

## üìù –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **`src/lib/bot-api.ts`** - –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –±–æ—Ç–∞ —Å backend API
   - `createOrUpdateUser()` - —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - `getUserSubscription()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–ø–∏—Å–∫–∏

---

## ‚ö†Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ backend API

–î–ª—è –ø–æ–ª–Ω–æ–π —Ä–∞–±–æ—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Ç—Ä–µ–±—É—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ endpoint'—ã –Ω–∞ backend:

### 1. POST /auth/telegram (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)

–ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç –±–æ—Ç–∞ (–±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–∏ –¥–ª—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –º–∞—Ä–∫–µ—Ä–∞).

**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**
- Backend –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å Telegram (hash)
- –ë–æ—Ç –Ω–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –≤–∞–ª–∏–¥–Ω—É—é –ø–æ–¥–ø–∏—Å—å
- –ó–∞–ø—Ä–æ—Å—ã –æ—Ç –±–æ—Ç–∞ –æ—Ç–∫–ª–æ–Ω—è—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–∏—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –º–∞—Ä–∫–µ—Ä –¥–ª—è –±–æ—Ç–∞: `hash: 'bot-created-user'`
- –ü—Ä–æ–ø—É—Å–∫–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∏ –¥–ª—è —ç—Ç–æ–≥–æ –º–∞—Ä–∫–µ—Ä–∞
- –ò–ª–∏ —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π endpoint `/auth/telegram-bot`

### 2. GET /user/subscription?telegramId=<id> (–Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å)

–ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ Telegram ID –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π GET /user/subscription —Å bot token –≤ header
- –ò–ª–∏ —Å–æ–∑–¥–∞—Ç—å —Å–ª—É–∂–µ–±–Ω—ã–π endpoint –¥–ª—è –±–æ—Ç–∞

---

## üöÄ Deployment

**URL:** https://app.outlivion.space  
**Bot:** https://t.me/outlivionbot  
**Status:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç

---

## üìä –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å

- ‚úÖ –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ `/start` —Å Markdown —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "üöÄ –û—Ç–∫—Ä—ã—Ç—å Mini App" —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Callback –∫–Ω–æ–ø–∫–∏ (FAQ, Support) —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ Webhook –∑–∞—â–∏—â—ë–Ω secret token
- ‚è≥ –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î (—Ç—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è backend)
- ‚è≥ –†–µ–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ (—Ç—Ä–µ–±—É–µ—Ç endpoint –Ω–∞ backend)

---

## üîß –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –î–ª—è frontend —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:
- ‚úÖ –í—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- –ú–æ–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–æ—Ç–∞

### –î–ª—è backend —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:
1. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç –±–æ—Ç–∞ –≤ `/auth/telegram`
2. –°–æ–∑–¥–∞—Ç—å endpoint `/user/subscription?telegramId=<id>` –¥–ª—è –±–æ—Ç–∞
3. –ò–ª–∏ —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π endpoint `/bot/user-sync` –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

---

**–°–æ–∑–¥–∞–Ω–æ:** 3 –¥–µ–∫–∞–±—Ä—è 2025, 23:08 MSK

