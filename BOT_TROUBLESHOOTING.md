# üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: –ü–æ—á–µ–º—É –±–æ—Ç –º–æ–∂–µ—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å

**–î–∞—Ç–∞:** 3 –¥–µ–∫–∞–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

---

## üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

- ‚úÖ Webhook —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: `https://app.outlivion.space/api/bot`
- ‚ùå –ü–æ—Å–ª–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞: `401 Unauthorized` (–Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–µ–π)
- ‚úÖ Pending updates: 0
- ‚úÖ Bot token –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –≤–∞–ª–∏–¥–µ–Ω

---

## üî¥ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–±–ª–µ–º

### 1. –û—à–∏–±–∫–∞ 401 Unauthorized

**–°–∏–º–ø—Ç–æ–º—ã:**
- Telegram –ø–æ–ª—É—á–∞–µ—Ç `401 Unauthorized` –æ—Ç webhook
- `last_error_message`: "Wrong response from the webhook: 401 Unauthorized"

**–ü—Ä–∏—á–∏–Ω—ã:**
- `verifyWebhookSecret` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `false`
- –í Vercel —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `TELEGRAM_WEBHOOK_SECRET`, –Ω–æ webhook —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ë–ï–ó `secret_token`
- Secret token –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: –£–¥–∞–ª–∏—Ç—å TELEGRAM_WEBHOOK_SECRET –∏–∑ Vercel (–µ—Å–ª–∏ webhook –±–µ–∑ secret)
vercel env rm TELEGRAM_WEBHOOK_SECRET production

# –í–∞—Ä–∏–∞–Ω—Ç 2: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å webhook —Å secret_token
npm run setup:webhook
# (–ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∞–ª–∏–¥–Ω–æ–≥–æ secret –≤ Vercel)
```

---

### 2. –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—ã

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/start`, –Ω–æ –±–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
- –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö, –Ω–æ –∏ –Ω–µ—Ç –æ—Ç–≤–µ—Ç–∞

**–ü—Ä–∏—á–∏–Ω—ã:**
- –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ Telegram API
- –ü—Ä–æ–±–ª–µ–º–∞ —Å —Ñ–æ—Ä–º–∞—Ç–æ–º —Å–æ–æ–±—â–µ–Ω–∏—è (Markdown, —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã)
- –ü—Ä–æ–±–ª–µ–º–∞ —Å –∫–Ω–æ–ø–∫–∞–º–∏ (–Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π URL)
- –û—à–∏–±–∫–∞ –≤ `sendMessage` –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
vercel logs app.outlivion.space --since 5m | grep "sendMessage\|Telegram API"
```

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫ Telegram API
- –£–ø—Ä–æ—Å—Ç–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ (—É–±—Ä–∞—Ç—å Markdown)
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å URL –≤ –∫–Ω–æ–ø–∫–∞—Ö

---

### 3. Callback query –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ö–Ω–æ–ø–∫–∏ –Ω–µ —Ä–µ–∞–≥–∏—Ä—É—é—Ç –Ω–∞ –Ω–∞–∂–∞—Ç–∏–µ
- –ö–Ω–æ–ø–∫–∞ "–∑–∞–ª–∏–ø–∞–µ—Ç" (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç loading)

**–ü—Ä–∏—á–∏–Ω—ã:**
- `answerCallbackQuery` –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
- –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `answerCallbackQuery`
- –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π `callback_data`

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ callback queries
vercel logs app.outlivion.space --since 5m | grep "callback\|Callback"
```

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `callback_data` —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ `answerCallbackQuery` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞

---

### 4. Webhook —É–¥–∞–ª—è–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- `getWebhookInfo` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `url: null`
- –ë–æ—Ç –ø–µ—Ä–µ—Å—Ç–∞—ë—Ç –ø–æ–ª—É—á–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–ü—Ä–∏—á–∏–Ω—ã:**
- Webhook –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ 200 OK
- Webhook –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 5 —Å–µ–∫—É–Ω–¥
- Webhook –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø–æ–¥—Ä—è–¥

**–†–µ—à–µ–Ω–∏–µ:**
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `200 OK`
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±—ã—Å—Ç—Ä–æ–π (–∏–ª–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π)
- –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å webhook: `npm run setup:webhook`

---

### 5. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- `TELEGRAM_BOT_TOKEN not configured`
- `NEXT_PUBLIC_MINIAPP_URL` –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Vercel
vercel env ls

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ GET /api/bot
curl https://app.outlivion.space/api/bot | jq .
```

**–†–µ—à–µ–Ω–∏–µ:**
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ Vercel
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `NEXT_PUBLIC_MINIAPP_URL` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (https://app.outlivion.space)

---

## üîß –ü–æ—à–∞–≥–æ–≤–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å webhook

```bash
curl -s "https://api.telegram.org/bot<TOKEN>/getWebhookInfo" | jq .
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- `url`: `https://app.outlivion.space/api/bot`
- `pending_update_count`: 0
- `last_error_message`: `null` –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å endpoint

```bash
curl https://app.outlivion.space/api/bot
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
JSON —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å—Ç–∞—Ç—É—Å–µ –±–æ—Ç–∞

### –®–∞–≥ 3: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å webhook –Ω–∞–ø—Ä—è–º—É—é

```bash
curl -X POST "https://app.outlivion.space/api/bot" \
  -H "Content-Type: application/json" \
  -d '{
    "update_id": 999999999,
    "message": {
      "message_id": 1,
      "from": {"id": 782245481, "is_bot": false, "first_name": "–¢–µ—Å—Ç"},
      "chat": {"id": 782245481, "type": "private"},
      "date": 1764785000,
      "text": "/start"
    }
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
`{"ok":true}`

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Vercel

```bash
vercel logs app.outlivion.space --since 5m | grep BOT
```

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å:**
- `[BOT] Received message` - —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç
- `[BOT] Message sent successfully` - —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
- `[BOT] Error` - –æ—à–∏–±–∫–∏
- `[BOT] verifyWebhookSecret` - –ø—Ä–æ–≤–µ—Ä–∫–∞ secret

---

## üéØ –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ï—Å–ª–∏ –±–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç:

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å webhook:**
   ```bash
   curl -s "https://api.telegram.org/bot<TOKEN>/getWebhookInfo" | jq .result.url
   ```

2. **–ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å webhook:**
   ```bash
   npm run setup:webhook
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:**
   ```bash
   vercel env ls | grep TELEGRAM
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:**
   ```bash
   vercel logs app.outlivion.space --since 2m | grep -E "BOT|Error"
   ```

5. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–æ—Ç–∞:**
   - –û—Ç–∫—Ä—ã—Ç—å: https://t.me/outlivionbot
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å: `/start`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç

---

## üìù –ß–µ–∫–ª–∏—Å—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

- [ ] Webhook —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –∞–∫—Ç–∏–≤–µ–Ω
- [ ] `pending_update_count` = 0
- [ ] `last_error_message` = null
- [ ] `TELEGRAM_BOT_TOKEN` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ Vercel
- [ ] `NEXT_PUBLIC_MINIAPP_URL` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- [ ] Endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200 OK
- [ ] –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- [ ] –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —É—Å–ø–µ—à–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö

---

## üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞: verifyWebhookSecret –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç false

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `TELEGRAM_WEBHOOK_SECRET` –≤ Vercel
2. –ï—Å–ª–∏ webhook —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ë–ï–ó secret_token ‚Üí —É–¥–∞–ª–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
3. –ï—Å–ª–∏ webhook —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –° secret_token ‚Üí —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ `[BOT] Telegram API response`
2. –£–ø—Ä–æ—Å—Ç–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ (—É–±—Ä–∞—Ç—å Markdown)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å URL –≤ –∫–Ω–æ–ø–∫–∞—Ö

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 3 –¥–µ–∫–∞–±—Ä—è 2025

